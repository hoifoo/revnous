<!-- Cookie Consent Banner -->
<div id="cookie-consent-banner" class="hidden fixed bottom-0 left-0 right-0 bg-white border-t-2 border-gray-200 shadow-2xl z-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
      <div class="flex-1">
        <div class="flex items-start gap-3">
          <div class="flex-shrink-0 mt-1">
            <svg class="w-6 h-6 text-pink-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
          </div>
          <div>
            <h3 class="text-lg font-semibold text-gray-900 mb-2">We value your privacy</h3>
            <p class="text-sm text-gray-600 max-w-3xl">
              We use cookies and similar technologies to improve your experience on our website and for marketing purposes.
              We share usage data with our analytics partners (like Google Analytics) to help us understand how visitors use our site.
              We do not sell your personal data.
              By clicking "Accept All", you consent to our use of cookies.
              <%= link_to "Learn more", privacy_policy_path, class: "text-pink-600 hover:text-pink-700 underline", target: "_blank" %>
            </p>
          </div>
        </div>
      </div>

      <div class="flex flex-col sm:flex-row gap-3 w-full md:w-auto">
        <button id="cookie-consent-decline" class="px-6 py-2.5 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition font-medium text-sm whitespace-nowrap">
          Decline Optional
        </button>
        <button id="cookie-consent-accept" class="px-6 py-2.5 bg-pink-600 text-white rounded-md hover:bg-pink-700 transition font-medium text-sm whitespace-nowrap">
          Accept All
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  (function() {
    const CONSENT_KEY = 'revnous_cookie_consent';
    const CONSENT_EXPIRY_DAYS = 365;

    const banner = document.getElementById('cookie-consent-banner');
    const acceptBtn = document.getElementById('cookie-consent-accept');
    const declineBtn = document.getElementById('cookie-consent-decline');

    // Check if user has already made a choice
    function getConsent() {
      const consent = localStorage.getItem(CONSENT_KEY);
      if (consent) {
        try {
          const data = JSON.parse(consent);
          const expiryDate = new Date(data.expiry);
          if (expiryDate > new Date()) {
            return data.value;
          } else {
            localStorage.removeItem(CONSENT_KEY);
          }
        } catch (e) {
          localStorage.removeItem(CONSENT_KEY);
        }
      }
      return null;
    }

    // Save consent choice
    function saveConsent(value) {
      const expiryDate = new Date();
      expiryDate.setDate(expiryDate.getDate() + CONSENT_EXPIRY_DAYS);

      const data = {
        value: value,
        expiry: expiryDate.toISOString(),
        timestamp: new Date().toISOString()
      };

      localStorage.setItem(CONSENT_KEY, JSON.stringify(data));
    }

    // Initialize Google Analytics if consent is given
    function initializeAnalytics() {
      // Check if Google Analytics is configured
      if (typeof gtag !== 'undefined') {
        gtag('consent', 'update', {
          'analytics_storage': 'granted',
          'ad_storage': 'granted'
        });
      }

      // You can add other analytics initialization here
      console.log('Analytics initialized with user consent');
    }

    // Disable analytics
    function disableAnalytics() {
      if (typeof gtag !== 'undefined') {
        gtag('consent', 'update', {
          'analytics_storage': 'denied',
          'ad_storage': 'denied'
        });
      }

      console.log('Analytics disabled by user choice');
    }

    // Show banner
    function showBanner() {
      banner.classList.remove('hidden');
      banner.classList.add('animate-slide-up');
    }

    // Hide banner
    function hideBanner() {
      banner.classList.add('hidden');
    }

    // Handle accept
    acceptBtn.addEventListener('click', function() {
      saveConsent('accepted');
      initializeAnalytics();
      hideBanner();
    });

    // Handle decline
    declineBtn.addEventListener('click', function() {
      saveConsent('declined');
      disableAnalytics();
      hideBanner();
    });

    // Check consent on page load
    document.addEventListener('DOMContentLoaded', function() {
      const consent = getConsent();

      if (consent === null) {
        // No consent recorded, show banner
        showBanner();
        // Set default consent to denied until user accepts
        if (typeof gtag !== 'undefined') {
          gtag('consent', 'default', {
            'analytics_storage': 'denied',
            'ad_storage': 'denied'
          });
        }
      } else if (consent === 'accepted') {
        // User has accepted, initialize analytics
        initializeAnalytics();
      } else if (consent === 'declined') {
        // User has declined, ensure analytics is disabled
        disableAnalytics();
      }

      // Cookie Settings link in footer
      const cookieSettingsLink = document.getElementById('cookie-settings-link');
      if (cookieSettingsLink) {
        cookieSettingsLink.addEventListener('click', function(e) {
          e.preventDefault();
          showBanner();
        });
      }
    });

    // Expose function globally for cookie settings link
    window.showCookieBanner = function() {
      showBanner();
    };
  })();
</script>

<style>
  @keyframes slide-up {
    from {
      transform: translateY(100%);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  .animate-slide-up {
    animation: slide-up 0.3s ease-out;
  }
</style>
