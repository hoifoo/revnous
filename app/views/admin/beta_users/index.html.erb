<div class="max-w-7xl mx-auto">
  <div class="flex justify-between items-center mb-8">
    <h1 class="text-3xl font-bold text-gray-900">Beta Users</h1>
  </div>

  <!-- Search and Filter -->
  <div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <%= form_with url: admin_beta_users_path, method: :get, class: "flex gap-4" do |form| %>
      <div class="flex-1">
        <%= form.text_field :search, value: params[:search], placeholder: "Search by name, email, or company...", class: "w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-pink-500 focus:border-transparent" %>
      </div>
      <div>
        <%= form.select :product_id,
            options_from_collection_for_select(Product.ordered, :id, :name, params[:product_id]),
            { prompt: "All Products" },
            { class: "px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-pink-500 focus:border-transparent" } %>
      </div>
      <%= form.submit "Search", class: "px-6 py-2 bg-pink-600 text-white rounded-md hover:bg-pink-700 transition font-medium cursor-pointer" %>
      <% if params[:search].present? || params[:product_id].present? %>
        <%= link_to "Clear", admin_beta_users_path, class: "px-6 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition font-medium" %>
      <% end %>
    <% end %>
  </div>

  <% if @beta_users.any? %>
    <!-- Stats -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
      <div class="bg-white rounded-lg shadow-md p-6">
        <div class="text-sm text-gray-600 mb-1">Total Beta Users</div>
        <div class="text-3xl font-bold text-gray-900"><%= BetaUser.count %></div>
      </div>
      <div class="bg-white rounded-lg shadow-md p-6">
        <div class="text-sm text-gray-600 mb-1">This Week</div>
        <div class="text-3xl font-bold text-gray-900"><%= BetaUser.where("created_at >= ?", 1.week.ago).count %></div>
      </div>
      <div class="bg-white rounded-lg shadow-md p-6">
        <div class="text-sm text-gray-600 mb-1">This Month</div>
        <div class="text-3xl font-bold text-gray-900"><%= BetaUser.where("created_at >= ?", 1.month.ago).count %></div>
      </div>
    </div>

    <div class="bg-white shadow-md rounded-lg overflow-hidden">
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Company</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Website</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Store Link</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Submitted</th>
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <% @beta_users.each do |beta_user| %>
              <tr class="hover:bg-gray-50">
                <td class="px-6 py-4">
                  <div class="text-sm font-medium text-gray-900"><%= beta_user.name %></div>
                  <% if beta_user.message.present? %>
                    <div class="text-xs text-gray-500 mt-1" title="<%= beta_user.message %>">
                      <%= beta_user.message.truncate(50) %>
                    </div>
                  <% end %>
                </td>
                <td class="px-6 py-4">
                  <a href="mailto:<%= beta_user.email %>" class="text-sm text-pink-600 hover:text-pink-900">
                    <%= beta_user.email %>
                  </a>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm text-gray-900">
                    <%= beta_user.company.present? ? beta_user.company : '-' %>
                  </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-pink-100 text-pink-800">
                    <%= beta_user.product&.name || 'Unknown' %>
                  </span>
                </td>
                <td class="px-6 py-4">
                  <% if beta_user.website.present? %>
                    <a href="<%= beta_user.website %>" target="_blank" class="text-xs text-blue-600 hover:text-blue-900">
                      <%= beta_user.website.gsub(/^https?:\/\//, '').truncate(30) %>
                    </a>
                  <% else %>
                    <span class="text-sm text-gray-400">-</span>
                  <% end %>
                </td>
                <td class="px-6 py-4">
                  <% if beta_user.store_link.present? %>
                    <a href="<%= beta_user.store_link %>" target="_blank" class="text-xs text-blue-600 hover:text-blue-900">
                      <%= beta_user.store_link.gsub(/^https?:\/\//, '').truncate(30) %>
                    </a>
                  <% else %>
                    <span class="text-sm text-gray-400">-</span>
                  <% end %>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                  <%= beta_user.created_at.strftime("%b %d, %Y") %>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                  <%= button_to "Delete", admin_beta_user_path(beta_user), method: :delete, data: { turbo_confirm: "Are you sure you want to delete this beta user?" }, class: "text-red-600 hover:text-red-900" %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>

    <%= paginate @beta_users, theme: 'twitter-bootstrap-4' if @beta_users.total_pages > 1 %>
  <% else %>
    <div class="bg-white rounded-lg shadow-md p-12 text-center">
      <p class="text-gray-500 mb-4">
        <% if params[:search].present? || params[:product_id].present? %>
          No beta users found matching your criteria
        <% else %>
          No beta users yet
        <% end %>
      </p>
      <% if params[:search].present? || params[:product_id].present? %>
        <%= link_to "Clear filters", admin_beta_users_path, class: "px-4 py-2 bg-pink-600 text-white rounded-md hover:bg-pink-700 transition font-medium" %>
      <% end %>
    </div>
  <% end %>
</div>
