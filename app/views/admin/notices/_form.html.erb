<%= form_with(model: [:admin, @notice], class: "space-y-6") do |form| %>
  <% if @notice.errors.any? %>
    <div class="bg-red-50 border-l-4 border-red-500 p-4">
      <h3 class="text-sm font-medium text-red-800 mb-2">
        <%= pluralize(@notice.errors.count, "error") %> prohibited this notice from being saved:
      </h3>
      <ul class="list-disc list-inside text-sm text-red-700">
        <% @notice.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div>
    <%= form.label :message, class: "block text-sm font-medium text-gray-700 mb-2" %>
    <%= form.text_area :message, rows: 3, class: "w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-pink-500 focus:border-transparent", placeholder: "ðŸŽ‰ Summer Sale - 50% OFF all products!" %>
    <p class="text-sm text-gray-500 mt-1">The main message to display in the banner</p>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div>
      <%= form.label :link_url, "Link URL (optional)", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= form.text_field :link_url, class: "w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-pink-500 focus:border-transparent", placeholder: "https://apps.shopify.com/pricing-schedule" %>
      <p class="text-sm text-gray-500 mt-1">External links open in new tab</p>
    </div>

    <div>
      <%= form.label :link_text, "Link Text", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= form.select :link_text,
          options_for_select([
            ["Arrow (â†’)", "â†’"],
            ["Learn More", "Learn More"],
            ["Shop Now", "Shop Now"],
            ["Get Offer", "Get Offer"],
            ["Claim Discount", "Claim Discount"],
            ["View Details", "View Details"]
          ], @notice.link_text || "â†’"),
          {},
          class: "w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-pink-500 focus:border-transparent"
      %>
    </div>
  </div>

  <div>
    <%= form.label :background_color, "Background Color Theme", class: "block text-sm font-medium text-gray-700 mb-3" %>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
      <% Notice::BACKGROUND_COLORS.each do |value, config| %>
        <label class="relative flex items-center cursor-pointer">
          <%= form.radio_button :background_color, value, class: "sr-only peer" %>
          <div class="w-full <%= config[:classes] %> text-white px-4 py-3 rounded-md text-center text-sm font-medium peer-checked:ring-4 peer-checked:ring-pink-300 transition">
            <%= config[:label] %>
          </div>
        </label>
      <% end %>
    </div>
  </div>

  <div>
    <%= form.label :active, class: "flex items-center cursor-pointer" %>
    <div class="flex items-center">
      <%= form.check_box :active, class: "h-5 w-5 text-pink-600 focus:ring-pink-500 border-gray-300 rounded" %>
      <span class="ml-2 text-sm text-gray-600">
        Show this notice on the website (only one notice can be active at a time)
      </span>
    </div>
  </div>

  <!-- Preview Section -->
  <div class="border-t border-gray-200 pt-6">
    <h3 class="text-sm font-medium text-gray-700 mb-3">Preview</h3>
    <div id="notice-preview" class="<%= @notice.background_classes || 'bg-gradient-to-r from-pink-600 to-purple-600' %> text-white py-3 rounded-lg">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-center gap-2 text-sm">
          <span class="font-medium" id="preview-message"><%= @notice.message || "Your message will appear here..." %></span>
          <span id="preview-link"><%= @notice.link_text || "â†’" %></span>
        </div>
      </div>
    </div>
  </div>

  <div class="flex items-center justify-end space-x-4 pt-6 border-t border-gray-200">
    <%= link_to "Cancel", admin_notices_path, class: "px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition font-medium" %>
    <%= form.submit class: "px-6 py-2 bg-pink-600 text-white rounded-md hover:bg-pink-700 transition font-medium cursor-pointer" %>
  </div>
<% end %>

<script>
  // Live preview update
  document.addEventListener('DOMContentLoaded', function() {
    const messageField = document.querySelector('textarea[name="notice[message]"]');
    const linkTextField = document.querySelector('select[name="notice[link_text]"]');
    const colorRadios = document.querySelectorAll('input[name="notice[background_color]"]');
    const preview = document.getElementById('notice-preview');
    const previewMessage = document.getElementById('preview-message');
    const previewLink = document.getElementById('preview-link');

    if (messageField) {
      messageField.addEventListener('input', function() {
        previewMessage.textContent = this.value || 'Your message will appear here...';
      });
    }

    if (linkTextField) {
      linkTextField.addEventListener('change', function() {
        previewLink.textContent = this.value;
      });
    }

    colorRadios.forEach(function(radio) {
      radio.addEventListener('change', function() {
        const selectedConfig = <%= Notice::BACKGROUND_COLORS.to_json.html_safe %>[this.value];
        preview.className = selectedConfig.classes + ' text-white py-3 rounded-lg';
      });
    });
  });
</script>
